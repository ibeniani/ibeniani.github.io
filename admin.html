<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - FastFix 72</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="loginSection" class="container mt-5">
        <h2>Connexion Admin</h2>
        <form id="loginForm">
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Mot de passe</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <button type="submit" class="btn btn-primary">Se connecter</button>
        </form>
        <p id="loginError" class="text-danger mt-3" style="display:none;"></p>
    </div>

    <div id="adminSection" style="display:none;" class="container mt-5">
        <h2>Dashboard Admin</h2>
        <button id="logoutBtn" class="btn btn-danger mb-3">Se déconnecter</button>
        
        <ul class="nav nav-tabs" id="adminTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="clients-tab" data-bs-toggle="tab" href="#clients" role="tab">Clients</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="repairs-tab" data-bs-toggle="tab" href="#repairs" role="tab">Réparations</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="sales-tab" data-bs-toggle="tab" href="#sales" role="tab">Annonces Ventes</a>
            </li>
        </ul>
        
        <div class="tab-content" id="adminTabContent">
            <!-- Onglet Clients -->
            <div class="tab-pane fade show active" id="clients" role="tabpanel">
                <h3>Ajouter un Client</h3>
                <form id="addClientForm">
                    <div class="row">
                        <div class="col-md-3"><input type="text" class="form-control" placeholder="Nom" id="clientNom" required></div>
                        <div class="col-md-3"><input type="text" class="form-control" placeholder="Prénom" id="clientPrenom" required></div>
                        <div class="col-md-3"><input type="tel" class="form-control" placeholder="Téléphone" id="clientTel" required></div>
                        <div class="col-md-3"><input type="text" class="form-control" placeholder="Modèle Téléphone" id="clientModel" required></div>
                    </div>
                    <button type="submit" class="btn btn-success mt-3">Ajouter Client</button>
                </form>
                <h3 class="mt-4">Liste des Clients</h3>
                <input type="text" id="searchClients" class="form-control mb-3" placeholder="Rechercher par nom...">
                <table class="table table-striped" id="clientsTable">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Prénom</th>
                            <th>Téléphone</th>
                            <th>Modèle Téléphone</th>
                        </tr>
                    </thead>
                    <tbody id="clientsTableBody"></tbody>
                </table>
            </div>
            
            <!-- Onglet Réparations -->
            <div class="tab-pane fade" id="repairs" role="tabpanel">
                <h3>Ajouter une Réparation</h3>
                <form id="addRepairForm">
                    <select class="form-control mb-3" id="repairClient" required>
                        <option value="">Sélectionner un client</option>
                    </select>
                    <input type="text" class="form-control mb-3" placeholder="Problème" id="repairProblem" required>
                    <input type="date" class="form-control mb-3" id="repairDate" required>
                    <select class="form-control mb-3" id="repairStatus">
                        <option value="En attente">En attente</option>
                        <option value="En cours">En cours</option>
                        <option value="Terminée">Terminée</option>
                    </select>
                    <button type="submit" class="btn btn-success">Ajouter Réparation</button>
                </form>
                <h3 class="mt-4">Liste des Réparations</h3>
                <ul id="repairsList" class="list-group"></ul>
            </div>
            
            <!-- Onglet Annonces Ventes -->
            <div class="tab-pane fade" id="sales" role="tabpanel">
                <h3>Ajouter une Annonce</h3>
                <form id="addSaleForm">
                    <input type="text" class="form-control mb-3" placeholder="Modèle (ex. iPhone 12)" id="saleModel" required>
                    <input type="number" class="form-control mb-3" placeholder="Prix (€)" id="salePrice" required>
                    <textarea class="form-control mb-3" placeholder="Description" id="saleDesc" required></textarea>
                    <input type="url" class="form-control mb-3" placeholder="URL Image" id="saleImage" required>
                    <button type="submit" class="btn btn-success">Publier Annonce</button>
                </form>
                <h3 class="mt-4">Annonces Actives</h3>
                <ul id="salesList" class="list-group"></ul>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCYboBQuUWjos9q0M6bD6GSuQ09Se29t9o",
            authDomain: "fastfix72-45e6b.firebaseapp.com",
            projectId: "fastfix72-45e6b",
            storageBucket: "fastfix72-45e6b.firebasestorage.app",
            messagingSenderId: "90073792848",
            appId: "1:90073792848:web:b4992b9265b1ba0cc9ac55",
            measurementId: "G-60F64PQP29"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        console.log('Firebase initialized');

        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginSection = document.getElementById('loginSection');
        const adminSection = document.getElementById('adminSection');
        const loginError = document.getElementById('loginError');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            console.log('Login form submitted');
            const email = loginForm.email.value;
            const password = loginForm.password.value;
            try {
                await auth.signInWithEmailAndPassword(email, password);
                console.log('Login successful');
                loginSection.style.display = 'none';
                adminSection.style.display = 'block';
                loadData();
            } catch (error) {
                console.error('Login error:', error);
                loginError.textContent = 'Erreur : ' + error.message;
                loginError.style.display = 'block';
            }
        });

        logoutBtn.addEventListener('click', async () => {
            await auth.signOut();
            loginSection.style.display = 'block';
            adminSection.style.display = 'none';
        });

        auth.onAuthStateChanged((user) => {
            if (user) {
                console.log('User logged in:', user.email);
                loginSection.style.display = 'none';
                adminSection.style.display = 'block';
                loadData();
            } else {
                console.log('No user logged in');
                loginSection.style.display = 'block';
                adminSection.style.display = 'none';
            }
        });

        async function loadData() {
            try {
                await loadClients();
                await loadRepairs();
                await loadSales();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        async function loadClients() {
            const clientsTableBody = document.getElementById('clientsTableBody');
            clientsTableBody.innerHTML = '';
            const querySnapshot = await db.collection('clients').get();
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${data.nom}</td>
                    <td>${data.prenom}</td>
                    <td>${data.tel}</td>
                    <td>${data.model}</td>
                `;
                clientsTableBody.appendChild(row);
            });
            // Peupler le select pour les réparations
            const repairClientSelect = document.getElementById('repairClient');
            repairClientSelect.innerHTML = '<option value="">Sélectionner un client</option>';
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const option = document.createElement('option');
                option.value = doc.id;
                option.textContent = `${data.nom} ${data.prenom}`;
                repairClientSelect.appendChild(option);
            });
        }

        async function loadRepairs() {
            const repairsList = document.getElementById('repairsList');
            repairsList.innerHTML = '';
            const querySnapshot = await db.collection('repairs').get();
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.textContent = `Client: ${data.clientId} - Problème: ${data.problem} - Date: ${data.date} - Statut: ${data.status}`;
                repairsList.appendChild(li);
            });
        }

        async function loadSales() {
            const salesList = document.getElementById('salesList');
            salesList.innerHTML = '';
            const querySnapshot = await db.collection('sales').get();
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.textContent = `${data.model} - ${data.price}€ - ${data.desc}`;
                salesList.appendChild(li);
            });
        }

        // Barre de recherche pour clients
        document.getElementById('searchClients').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#clientsTableBody tr');
            rows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                row.style.display = name.includes(searchTerm) ? '' : 'none';
            });
        });

        document.getElementById('addClientForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const nom = document.getElementById('clientNom').value;
                const prenom = document.getElementById('clientPrenom').value;
                const tel = document.getElementById('clientTel').value;
                const model = document.getElementById('clientModel').value;
                await db.collection('clients').add({ nom, prenom, tel, model });
                loadClients();
                e.target.reset();
            } catch (error) {
                console.error('Error adding client:', error);
                alert('Erreur lors de l\'ajout du client : ' + error.message);
            }
        });

        document.getElementById('addRepairForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const clientId = document.getElementById('repairClient').value;
                const problem = document.getElementById('repairProblem').value;
                const date = document.getElementById('repairDate').value;
                const status = document.getElementById('repairStatus').value;
                await db.collection('repairs').add({ clientId, problem, date, status });
                loadRepairs();
                e.target.reset();
            } catch (error) {
                console.error('Error adding repair:', error);
                alert('Erreur lors de l\'ajout de la réparation : ' + error.message);
            }
        });

        document.getElementById('addSaleForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const model = document.getElementById('saleModel').value;
                const price = document.getElementById('salePrice').value;
                const desc = document.getElementById('saleDesc').value;
                const image = document.getElementById('saleImage').value;
                await db.collection('sales').add({ model, price, desc, image });
                loadSales();
                e.target.reset();
            } catch (error) {
                console.error('Error adding sale:', error);
                alert('Erreur lors de l\'ajout de l\'annonce : ' + error.message);
            }
        });
    </script>
</body>
</html>
       
